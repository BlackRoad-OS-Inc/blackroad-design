name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  validate-tokens:
    name: Validate Design Tokens
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: {node-version: '20', cache: 'npm'}
      - run: npm ci --quiet
      - name: Run TypeScript tests
        run: npm test
      - name: Validate token JSON files
        run: |
          for f in tokens/*.json; do
            node -e "JSON.parse(require('fs').readFileSync('$f','utf8')); console.log('✓ $f')"
          done
      - name: Validate CSS variables
        run: |
          for f in css/*.css; do
            [ -f "$f" ] && echo "✓ $f" || echo "⚠ No CSS files yet"
          done
        continue-on-error: true
      - name: ✅ Design tokens valid
        run: echo "All design tokens validated"

  brand-compliance:
    name: Brand Color Compliance
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check for forbidden colors
        run: |
          FORBIDDEN="#FF9D00|#FF6B00|#FF0066|#FF006B|#D600AA|#7700FF|#0066FF"
          if grep -rn -E "$FORBIDDEN" --include="*.css" --include="*.ts" --include="*.tsx" --include="*.json" . 2>/dev/null; then
            echo "❌ Forbidden colors found (old brand system)"
            exit 1
          fi
          echo "✓ No forbidden colors found"
